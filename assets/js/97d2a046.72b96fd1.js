"use strict";(self.webpackChunknotas_personales=self.webpackChunknotas_personales||[]).push([[4792],{1501:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>t,contentTitle:()=>r,default:()=>u,frontMatter:()=>o,metadata:()=>c,toc:()=>l});var a=i(4848),s=i(8453);const o={title:"ExceptionTranslationFilter",sidebar_position:8},r=void 0,c={id:"Lenguajes de programaci\xf3n/Java/Spring/Spring Security/Arquitectura/ExceptionTranslationFilter",title:"ExceptionTranslationFilter",description:"El ExceptionTranslationFilter es un filtro en Spring Security que maneja excepciones relacionadas con la seguridad, espec\xedficamente las siguientes:",source:"@site/docs/Lenguajes de programaci\xf3n/Java/Spring/Spring Security/Arquitectura/ExceptionTranslationFilter.md",sourceDirName:"Lenguajes de programaci\xf3n/Java/Spring/Spring Security/Arquitectura",slug:"/Lenguajes de programaci\xf3n/Java/Spring/Spring Security/Arquitectura/ExceptionTranslationFilter",permalink:"/notas-de-aprendizaje/docs/Lenguajes de programaci\xf3n/Java/Spring/Spring Security/Arquitectura/ExceptionTranslationFilter",draft:!1,unlisted:!1,editUrl:"https://github.com/SanRM/notas-de-aprendizaje/edit/main/docs/Lenguajes de programaci\xf3n/Java/Spring/Spring Security/Arquitectura/ExceptionTranslationFilter.md",tags:[],version:"current",lastUpdatedBy:"SanRM",lastUpdatedAt:1729228641e3,sidebarPosition:8,frontMatter:{title:"ExceptionTranslationFilter",sidebar_position:8},sidebar:"tutorialSidebar",previous:{title:"Filtros personalizados",permalink:"/notas-de-aprendizaje/docs/Lenguajes de programaci\xf3n/Java/Spring/Spring Security/Arquitectura/Filtros personalizados"},next:{title:"Guardar y reutilizar solicitudes",permalink:"/notas-de-aprendizaje/docs/Lenguajes de programaci\xf3n/Java/Spring/Spring Security/Arquitectura/Guardar solicitudes"}},t={},l=[{value:"\xbfC\xf3mo se Inserta en la Cadena de Filtros?",id:"c\xf3mo-se-inserta-en-la-cadena-de-filtros",level:3},{value:"Relaci\xf3n con Otros Componentes",id:"relaci\xf3n-con-otros-componentes",level:3},{value:"1. Invocaci\xf3n del Resto de la Aplicaci\xf3n",id:"1-invocaci\xf3n-del-resto-de-la-aplicaci\xf3n",level:4},{value:"2. Manejo de AuthenticationException",id:"2-manejo-de-authenticationexception",level:4},{value:"3. Manejo de AccessDeniedException",id:"3-manejo-de-accessdeniedexception",level:4},{value:"4. No hay Excepciones",id:"4-no-hay-excepciones",level:4},{value:"Ejemplo de Pseudo C\xf3digo",id:"ejemplo-de-pseudo-c\xf3digo",level:3},{value:"Desglose del Pseudo C\xf3digo",id:"desglose-del-pseudo-c\xf3digo",level:4},{value:"\xbfD\xf3nde Se Usan Estas Excepciones?",id:"d\xf3nde-se-usan-estas-excepciones",level:3}];function d(e){const n={code:"code",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components},{Card:i}=n;return i||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Card",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.p,{children:["El ",(0,a.jsx)(n.strong,{children:"ExceptionTranslationFilter"})," es un filtro en Spring Security que maneja excepciones relacionadas con la seguridad, espec\xedficamente las siguientes:"]}),"\n",(0,a.jsx)(i,{color:"red",children:(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"AuthenticationException"}),": Se lanza cuando un usuario no est\xe1 autenticado (es decir, no ha proporcionado credenciales v\xe1lidas)."]}),"\n"]})}),"\n",(0,a.jsx)(i,{color:"pink",children:(0,a.jsxs)(n.ol,{start:"2",children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"AccessDeniedException"}),": Se lanza cuando un usuario est\xe1 autenticado pero no tiene los permisos necesarios para acceder a un recurso."]}),"\n"]})}),"\n",(0,a.jsx)(n.p,{children:"Este filtro convierte esas excepciones en respuestas HTTP apropiadas, permitiendo que la aplicaci\xf3n gestione de forma adecuada los casos en que un usuario no tiene acceso o no est\xe1 autenticado."}),"\n",(0,a.jsxs)(i,{children:[(0,a.jsx)(n.h3,{id:"c\xf3mo-se-inserta-en-la-cadena-de-filtros",children:"\xbfC\xf3mo se Inserta en la Cadena de Filtros?"}),(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"ExceptionTranslationFilter"})," es parte de la cadena de filtros de seguridad (FilterChainProxy), lo que significa que se ejecuta en el flujo de procesamiento de cada solicitud HTTP. Si se produce una excepci\xf3n durante el manejo de la solicitud, este filtro se encarga de capturarla y responder de manera adecuada."]})]}),"\n",(0,a.jsxs)(i,{children:[(0,a.jsx)(n.h3,{id:"relaci\xf3n-con-otros-componentes",children:"Relaci\xf3n con Otros Componentes"}),(0,a.jsxs)(n.p,{children:["El ",(0,a.jsx)(n.strong,{children:"ExceptionTranslationFilter"})," se relaciona con varios otros componentes que gestionan la seguridad en Spring. A continuaci\xf3n explico c\xf3mo funciona este filtro y su interacci\xf3n con otros elementos importantes:"]}),(0,a.jsxs)(i,{children:[(0,a.jsx)(n.h4,{id:"1-invocaci\xf3n-del-resto-de-la-aplicaci\xf3n",children:"1. Invocaci\xf3n del Resto de la Aplicaci\xf3n"}),(0,a.jsxs)(n.p,{children:["El primer paso que realiza el ",(0,a.jsx)(n.strong,{children:"ExceptionTranslationFilter"})," es invocar ",(0,a.jsx)(n.code,{children:"FilterChain.doFilter(request, response)"}),". Esto significa que llama a la cadena de filtros o al resto de la aplicaci\xf3n para que siga procesando la solicitud. Si no hay ninguna excepci\xf3n relacionada con la seguridad, la solicitud simplemente contin\xfaa su flujo normal."]})]}),(0,a.jsxs)(i,{children:[(0,a.jsx)(n.h4,{id:"2-manejo-de-authenticationexception",children:"2. Manejo de AuthenticationException"}),(0,a.jsxs)(n.p,{children:["Si el usuario no est\xe1 autenticado o si se produce una ",(0,a.jsx)(n.strong,{children:"AuthenticationException"})," durante el procesamiento de la solicitud, el filtro se encarga de ",(0,a.jsx)(n.strong,{children:"iniciar el proceso de autenticaci\xf3n"}),". Aqu\xed est\xe1n los pasos clave:"]}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Limpiar el SecurityContextHolder"}),": El ",(0,a.jsx)(n.code,{children:"SecurityContextHolder"})," es el lugar donde Spring Security almacena la informaci\xf3n de autenticaci\xf3n. Si ocurre una excepci\xf3n, se borra para asegurarse de que no se reutilice informaci\xf3n de autenticaci\xf3n no v\xe1lida."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Guardar la HttpServletRequest"}),': La solicitud original (que caus\xf3 la excepci\xf3n) se guarda. Esto permite que, una vez que el usuario se autentique correctamente, se "reproduzca" la solicitud original, de modo que el usuario no pierda su progreso.']}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Invocar el AuthenticationEntryPoint"}),": El ",(0,a.jsx)(n.code,{children:"AuthenticationEntryPoint"})," es el componente responsable de solicitar las credenciales al usuario. Por ejemplo, podr\xeda redirigir a una p\xe1gina de inicio de sesi\xf3n o enviar un encabezado ",(0,a.jsx)(n.code,{children:"WWW-Authenticate"})," en la respuesta HTTP para que el navegador solicite las credenciales."]}),"\n"]}),"\n"]})]}),(0,a.jsxs)(i,{children:[(0,a.jsx)(n.h4,{id:"3-manejo-de-accessdeniedexception",children:"3. Manejo de AccessDeniedException"}),(0,a.jsxs)(n.p,{children:["Si el usuario est\xe1 autenticado pero no tiene los permisos adecuados, se lanza una ",(0,a.jsx)(n.strong,{children:"AccessDeniedException"}),". En este caso:"]}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Invocar el AccessDeniedHandler"}),": El ",(0,a.jsx)(n.code,{children:"AccessDeniedHandler"}),' se encarga de gestionar esta situaci\xf3n y mostrar un mensaje apropiado al usuario. Puede ser una p\xe1gina que diga "Acceso denegado" o una respuesta HTTP con el estado 403 (Forbidden), lo que significa que el usuario no tiene los permisos necesarios.']}),"\n"]})]}),(0,a.jsxs)(i,{children:[(0,a.jsx)(n.h4,{id:"4-no-hay-excepciones",children:"4. No hay Excepciones"}),(0,a.jsxs)(n.p,{children:["Si no se lanza ninguna excepci\xf3n de seguridad, entonces el ",(0,a.jsx)(n.code,{children:"ExceptionTranslationFilter"})," no hace nada y deja que la solicitud contin\xfae su procesamiento normal."]})]})]}),"\n",(0,a.jsxs)(i,{color:"default",textAlign:"center",children:[(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:"https://docs.spring.io/spring-security/reference/_images/servlet/architecture/exceptiontranslationfilter.png",alt:"alt"})}),(0,a.jsx)(i,{children:(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["El ",(0,a.jsx)(n.strong,{children:"ExceptionTranslationFilter"})," invoca ",(0,a.jsx)(n.code,{children:"FilterChain.doFilter(request, response)"})," para continuar con el resto de la aplicaci\xf3n."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Si el usuario no est\xe1 autenticado o se produce una ",(0,a.jsx)(n.strong,{children:"AuthenticationException"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Comienza el proceso de ",(0,a.jsx)(n.strong,{children:"Autenticaci\xf3n"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:["El ",(0,a.jsx)(n.strong,{children:"SecurityContextHolder"})," se limpia."]}),"\n",(0,a.jsxs)(n.li,{children:["El ",(0,a.jsx)(n.strong,{children:"HttpServletRequest"})," se guarda para que pueda reutilizarse la solicitud original despu\xe9s de una autenticaci\xf3n exitosa."]}),"\n",(0,a.jsxs)(n.li,{children:["Se utiliza el ",(0,a.jsx)(n.strong,{children:"AuthenticationEntryPoint"})," para solicitar las credenciales del cliente (por ejemplo, redirigiendo a una p\xe1gina de inicio de sesi\xf3n o enviando un encabezado WWW-Authenticate)."]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Si se trata de una ",(0,a.jsx)(n.strong,{children:"AccessDeniedException"})," (denegaci\xf3n de acceso), se maneja con el ",(0,a.jsx)(n.strong,{children:"AccessDeniedHandler"})," para gestionar la denegaci\xf3n del acceso."]}),"\n"]}),"\n"]})})]}),"\n",(0,a.jsxs)(i,{color:"green",children:[(0,a.jsx)(n.h3,{id:"ejemplo-de-pseudo-c\xf3digo",children:"Ejemplo de Pseudo C\xf3digo"}),(0,a.jsxs)(n.p,{children:["Aqu\xed tienes un ejemplo simplificado de c\xf3mo funciona el ",(0,a.jsx)(n.strong,{children:"ExceptionTranslationFilter"})," en pseudoc\xf3digo:"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"try {\r\n    filterChain.doFilter(request, response);  // Invoca el resto de la aplicaci\xf3n\r\n} catch (AccessDeniedException | AuthenticationException ex) {\r\n    // Si no est\xe1 autenticado o es una AuthenticationException\r\n    if (!authenticated || ex instanceof AuthenticationException) {\r\n        startAuthentication();  // Inicia el proceso de autenticaci\xf3n\r\n    } else {\r\n        accessDenied();  // Maneja la denegaci\xf3n de acceso\r\n    }\r\n}\n"})}),(0,a.jsx)(n.h4,{id:"desglose-del-pseudo-c\xf3digo",children:"Desglose del Pseudo C\xf3digo"}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"filterChain.doFilter(request, response)"})}),": Este es el llamado al resto de la cadena de filtros o de la aplicaci\xf3n. Si la solicitud pasa sin problemas, este filtro no interviene m\xe1s."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Captura de Excepciones"}),": Si se lanza una excepci\xf3n, el filtro la captura. Si es una ",(0,a.jsx)(n.strong,{children:"AuthenticationException"})," o si el usuario no est\xe1 autenticado, se inicia el proceso de autenticaci\xf3n. Si es una ",(0,a.jsx)(n.strong,{children:"AccessDeniedException"}),", se maneja la denegaci\xf3n de acceso."]}),"\n"]}),"\n"]})]}),"\n",(0,a.jsxs)(i,{children:[(0,a.jsx)(n.h3,{id:"d\xf3nde-se-usan-estas-excepciones",children:"\xbfD\xf3nde Se Usan Estas Excepciones?"}),(0,a.jsxs)(n.p,{children:["Las excepciones como ",(0,a.jsx)(n.strong,{children:"AuthenticationException"})," y ",(0,a.jsx)(n.strong,{children:"AccessDeniedException"})," pueden ser lanzadas por otros componentes de seguridad, como el ",(0,a.jsx)(n.strong,{children:"FilterSecurityInterceptor"})," o la seguridad basada en m\xe9todos (cuando proteges m\xe9todos con anotaciones como ",(0,a.jsx)(n.code,{children:"@PreAuthorize"}),")."]})]}),"\n",(0,a.jsxs)(n.p,{children:["El ",(0,a.jsx)(n.strong,{children:"ExceptionTranslationFilter"})," es una pieza clave de la seguridad en Spring porque gestiona c\xf3mo se manejan los errores de autenticaci\xf3n y autorizaci\xf3n. Si hay un problema con la autenticaci\xf3n, el filtro inicia el proceso para que el usuario proporcione credenciales. Si hay un problema con los permisos, gestiona el acceso denegado. Al estar integrado en la cadena de filtros, este filtro asegura que tu aplicaci\xf3n responda correctamente a las solicitudes no autorizadas o no autenticadas."]})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>c});var a=i(6540);const s={},o=a.createContext(s);function r(e){const n=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),a.createElement(o.Provider,{value:n},e.children)}}}]);